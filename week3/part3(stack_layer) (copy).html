<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>D3 Page Template</title>
        <script type="text/javascript" src="../d3/d3.js"></script>
    </head>
    <body>
    	<script type="text/javascript">
		var dataset;
		var MONTH = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec" ];

		var CATEGORY = ["3", "2", "1", "0"];

//SVG

		//x-axis scale
		var w = 800
		var h = 300

		var xaxis = d3.scaleLinear()
		  		  .domain([0, 12])
		  		  .range([0, 800]);

		//y-axis scale
		var yaxis =  d3.scaleLinear()
		  		  .domain([0, 50])
		  		  .range([h, 0]);
		//console.log(xaxis(1))
		var svg = d3.select("body")
					.append("svg")
					.attr("width", w+100)
					.attr("height", h+100)
					.append("g")
					.attr("transform", "translate(50, 50)");

//color
		var color = d3.scaleOrdinal(d3.schemeCategory10);

//data

		var extractData = function(d){
			var newData=[];
			for (i=0; i<MONTH.length; i++){
				var rowData={};
				rowData['Month'] = i;
				for(j=0; j<d.length; j++){
					//console.log(d[j][months[i]]);
					rowData[j] = d[j][MONTH[i]];
					//console.log(rowData[j]);
				}
				newData[i] = rowData;
			}
			return newData;
		}

//stack

		var stackData2 = d3.stack().keys(CATEGORY);
 

		d3.csv("IQuantNY1.csv", function(error, data) {
				if (error) {
				console.log(error);
			} else {
				console.log(data);	
			}
			dataset = data;
			extractData(dataset);
			console.log(extractData(dataset));	
			//console.log(extractData(dataset)[0]['Month']);
			console.log(stackData2(extractData(dataset)));
			//console.log(stackData2(extractData(dataset))[0][0].data);

			var layer = svg.selectAll(".stack")
				.data(stackData2(extractData(dataset)), function(d) {return d.key;})
			   	.enter()
				.append("g")
        		.attr("class", "stack")
			   	.style("fill", function (d) {//console.log(d.key); 
											 return color(d.key);});
			
			layer.selectAll("rect")
					.data(function(d) {return d;})
					.enter()
					.append("rect")
					.attr("x", function(d) {//console.log(xaxis(d.data.Month)+xaxis(1)/3);
											return xaxis(d.data.Month)+xaxis(1)/3;})
					.attr("y", function(d) {//console.log(d[1] - d[0]); 
											return yaxis(d[1] - d[0]);})
					.attr("width", 20)
					.attr("height", function(d) {//console.log(yaxis(d[1] - d[0]));
												 return h - yaxis(d[1] - d[0]);});
//x axis
			svg.append("g")
			  .attr("class", "axis")
			  .attr("transform", "translate(0," + h + ")")// the axis coordination
			  .call(d3.axisBottom(xaxis))
			  .selectAll("text").remove();

			svg.append("g")
			  .attr("class", "axis")
			  .attr("transform", "translate(0, 0)")// the axis coordination
			  .call(d3.axisLeft(yaxis));
			})

        </script>
    </body>
</html>
